function toast(e,t,r){$.toast({heading:e,text:t,showHideTransition:"fade",icon:r,position:"bottom-right",hideAfter:5e3})}$(function(){"use strict";var e=$("#current_level").val(),t=$("#security_code").val();$("body").on("click",".users .addUser",function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;var r=$(".users .username").val(),a=$(".users .password").val(),s=$(".users .repassword").val(),n=$(".users .email").val(),i=$(this).data("url");if(""==r)$(".result").html("<span style='color:red'>Tên tài khoản không được để trống</span>");else if(""==a)$(".result").html("<span style='color:red'>Mật khẩu không được để trống</span>");else if(""==s)$(".result").html("<span style='color:red'>Mật khẩu nhập lại không được để trống</span>");else if(a!=s)$(".result").html("<span style='color:red'>Mật khẩu và mật khẩu nhập lại không khớp</span>");else{var l=$(this);$(l).addClass("disabled"),$.ajax({url:i,type:"POST",dataType:"JSON",data:{adduser:!0,username:r,password:a,email:n,security:t}}).done(function(e){var t=e[0];if(t.error)$(".result").html("<span style='color:red'>"+t.error+"</span>");else if(t.success){var r="<span style='color:green'>"+t.success+"</span>";$(".result").html(r),$(".username").val(""),$(".password").val(""),$(".repassword").val(""),$(".email").val("")}else $(".result").html("<span style='color:red'>Có lỗi vui lòng thử lại</span>")}).fail(function(){$(".result").html("<span style='color:red'>Có lỗi vui lòng thử lại</span>")}).always(function(){$(l).removeClass("disabled")})}}),$("body").on("click",".users .btn-edit",function(e){e.preventDefault(),$(this).addClass("hidden-xs-up"),$(this).next().removeClass("hidden-xs-up"),$(this).parents().prevAll(".username").children("input").removeAttr("disabled"),$(this).parents().prevAll(".email").children("input").removeAttr("disabled"),$(this).parents().prevAll(".role").children("select").removeAttr("disabled")}),$("body").on("click",".users .btn-remove",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if(0==confirm("Xác nhận lại lệnh xóa.."))return!1;if("mod"==e||"member"==e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;if("admin"!=e)return!1;parseInt($(this).parents().prevAll("th.id").html());var a=$(this).parents().prevAll("td.username").children("input").val(),s=$(this).data("url"),n=$(this).parents("tr.oneuser"),i=$(this).parents("td").html(),l=$(this).parents("td");$(this).parents("td").html('<span style="color:red">Đang xử lý.. </span>');var o=$(this);$(o).addClass("disabled"),$.ajax({url:s,type:"POST",dataType:"JSON",data:{username:a,security:t}}).done(function(e){(e=e[0]).error?toast("Thất bại",e.error,"error"):e.success?(toast("Thành công",e.error,"success"),$(n).remove()):toast("Thất bại","Lỗi server!","error")}).fail(function(){toast("Thất bại","Lỗi server!","error")}).always(function(){$(l).html(i),$(o).removeClass("disabled")})}),$("body").on("click",".users .btn-save",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("mod"==e||"member"==e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;if("admin"!=e)return!1;$(this).addClass("hidden-xs-up"),$(this).prev().removeClass("hidden-xs-up");var a=parseInt($(this).parents().prevAll("th.id").html()),s=$(this).parents().prevAll("td.username").children("input").val(),n=$(this).parents().prevAll("td.email").children("input").val(),i=$(this).parents().prevAll("td.role").children("select").val();if(""==a||""==s||""==n||""==i)return toast("","Thông tin không được để trống","error"),!1;var l=$(this).data("url"),o=($(this).parents("tr.oneuser"),$(this).parents("td").html()),d=$(this).parents("td");$(this).parents("td").html('<span style="color:red">Đang xử lý.. </span>');var c=$(this);$(c).addClass("disabled"),$.ajax({url:l,type:"POST",dataType:"JSON",data:{username:s,role:i,security:t,email:n}}).done(function(e){(e=e[0]).error?toast("Thất bại",e.error,"error"):e.success?toast("Thành công",e.success,"success"):toast("Thất bại","Lỗi server!","error")}).fail(function(){toast("Thất bại","Lỗi server!","error")}).always(function(){$(d).html(o),$(d).prevAll(".username").children("input").attr("disabled","disabled"),$(d).prevAll(".email").children("input").attr("disabled","disabled"),$(d).prevAll(".role").children("select").attr("disabled","disabled"),$(c).removeClass("disabled")})}),$("body").on("click",".btn-logout",function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;var t=$(this).data("href"),r=$(this);$(r).addClass("disabled"),$.ajax({url:t,type:"POST",dataType:"JSON",data:{logout:!0}}).done(function(e){e.error?toast("Thất bại",e.error,"error"):location.reload()}).fail(function(){toast("Thất bại","Có lỗi vui lòng thử lại sau","error")}).always(function(){$(r).removeClass("disabled")})}),$("body").on("change",".banner #chooseimagebanner",function(e){e.preventDefault();var t=$(this).prop("files")[0];if(null==t)return $(this).parents().nextAll(".result").html(""),void $(this).parents().nextAll(".review-image").children("img.img-thumb").removeAttr("src");if("image/jpg"!=t.type&&"image/jpeg"!=t.type&&"image/png"!=t.type&&"image/gif"!=t.type)return $(this).val(""),void $(this).parents().nextAll(".result").html("<span style='color:red'>Chỉ chấp nhận file ảnh</span>");$(this).parents().nextAll(".result").html("");var r=URL.createObjectURL(t);$(this).parents().nextAll(".review-image").children("img.img-thumb").attr("src",r)}),$("body").on("click",".banner .btn-addbanner",function(r){if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;var a=$("#chooseimagebanner").prop("files")[0],s=$(".banner .title").val(),n=$(this).data("url"),i=$(this).data("url_");if(null!=a&&""!=s){var l=new FormData;l.append("image",a),l.append("title",s),l.append("security",t),l.append("addbanner","");var o=$(this);$(o).addClass("disabled"),$.ajax({url:n,dataType:"JSON",type:"POST",cache:!1,contentType:!1,processData:!1,data:l}).done(function(e){if(e.error)toast("Thất bại",e.error,"error");else if(e.success){var t=e.success.data,r='<tr><th scope="row" class="stt">'+t.stt+'</th><td class="title">'+t.title+'</th><td style="width: 15%" class="image"><img class="img-fluid" src="'+t.url+'" alt="'+t.title+'"></td><td><b class="btn btn-danger btn-removebanner" data-url="'+i+'"><i class="fa fa-remove"></i></b></td></tr>';$(".banner .listbanner tbody").append(r),toast("Thành công","Thêm dữ liệu thành công","success")}else toast("Thất bại","Lỗi server","error")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$("#chooseimagebanner").val(""),$(".banner .review-image img").removeAttr("src"),$(".banner .title").val(""),$(o).removeClass("disabled")})}else toast("Có lỗi","Ảnh và mô tả không được để trống","error")}),$("body").on("click",".banner .btn-removebanner",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if(0==confirm("Xác nhận lại lệnh xóa.."))return!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;var a=$(this).data("url"),s=parseInt($(this).parents().prevAll("th").html()),n=$(this);$(n).addClass("disabled"),$.ajax({url:a+"/"+s,type:"POST",dataType:"JSON",data:{stt:s,security:t}}).done(function(e){if(e.error)toast("Thất bại",e.error,"error");else if(e.success){var t=e.success.data;$(".banner .listbanner tbody").html("");for(var r in t){var s='<tr><th scope="row" class="stt">'+t[r].stt+'</th><td class="title">'+t[r].title+'</th><td style="width: 15%" class="image"><img class="img-fluid" src="'+t[r].url+'" alt="'+t[r].title+'"></td><td><b class="btn btn-danger btn-removebanner" data-url="'+a+'"><i class="fa fa-remove"></i></b></td></tr>';$(".banner .listbanner tbody").append(s)}toast("Thành công","Xóa thành công","success")}else toast("Thất bại","Lỗi server","error")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(n).removeClass("disabled")})}),$("body").on("click",".category .btn-add",function(r){if($(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;var a=$(".category .add-name").val();if(""==a)return toast("Lỗi","Tên danh mục không được để trống","error"),$(".category .add-name").focus(),!1;var s=$(this).data("url"),n=$(".category .btn-save").data("url"),i=$(".category .btn-delete").data("url"),l=$(this);$(l).addClass("disabled"),$.ajax({url:s,type:"POST",dataType:"JSON",data:{name:a,security:t}}).done(function(e){if(e.error)toast("Thất bại",e.error,"error");else if(e.success){var t='<div class="card card-inverse card-primary mb-3"><div class="card-block"><div class="text-sm-right"><a class="btn btn-info btn-edit"><i class="fa fa-pencil"></i></a><a data-url="'+n+'" class="btn btn-success btn-save hidden-xs-up"><i class="fa fa-floppy-o" ></i></a><a data-url="'+i+'" class="btn btn-danger btn-delete"><i class="fa fa-remove"></i></a></div><blockquote class="card-blockquote  "><fieldset class="form-group hidden-xs-up "><input type="text" class="form-control name-edit" value="Laptop"><input type="hidden" class="form-control id" value="'+e.success.id+'"></fieldset><div class="name-category">'+e.success.name+"</div></blockquote></div></div>";$(".category .list-category").append(t),toast("Thành công","Thêm danh mục thành công","success")}else toast("Thất bại","Lỗi server","error")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(l).removeClass("disabled")})}),$("body").on("click",".category .btn-delete",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if(0==confirm("Xác nhận lại lệnh xóa.."))return!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;var a=$(this).parents(".card"),s=$(this).data("url"),n=$(this).nextAll(".id").val(),i=$(this);$(i).addClass("disabled"),$.ajax({url:s+"/"+n,type:"POST",dataType:"JSON",data:{security:t,id:n}}).done(function(e){e.error?toast("Thất bại",e.error,"error"):e.success?(toast("Thành công",e.success,"success"),$(a).remove()):toast("Thất bại","Lỗi server","error")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(i).removeClass("disabled")})}),$("body").on("click",".category .btn-edit",function(t){return t.preventDefault(),$(this).hasClass("disabled")?(toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1):"admin"!=e&&"mod"!=e?(toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1):($(this).addClass("hidden-xs-up"),$(this).next(".btn-save").removeClass("hidden-xs-up"),$(this).parents().next(".card-blockquote").find("fieldset").removeClass("hidden-xs-up"),void $(this).parents().next(".card-blockquote").find(".name-category").addClass("hidden-xs-up"))}),$("body").on("click",".category .btn-save",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;var a=$(this).nextAll(".id").val(),s=$(this).parents().nextAll(".card-blockquote").find(".name-edit").val();if(""==s)return toast("Lỗi","Tên danh mục không được để trống","error"),!1;var n=$(this).data("url"),i=$(this);$(i).addClass("disabled"),$.ajax({url:n+"/"+a,type:"POST",dataType:"JSON",data:{security:t,id:a,name:s}}).done(function(e){e.error?(toast("Thất bại",e.error,"error"),$(i).parents().next(".card-blockquote").find(".name-edit").val($(i).parents().next(".card-blockquote").find(".name-category").html())):e.success?(toast("Thành công",e.success,"success"),$(i).parents().next(".card-blockquote").find(".name-category").html(s)):(toast("Thất bại","Lỗi server","error"),$(i).parents().next(".card-blockquote").find(".name-edit").val($(i).parents().next(".card-blockquote").find(".name-category").html()))}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(i).addClass("hidden-xs-up"),$(i).prev(".btn-edit").removeClass("hidden-xs-up"),$(i).parents().next(".card-blockquote").find("fieldset").addClass("hidden-xs-up"),$(i).parents().next(".card-blockquote").find(".name-category").removeClass("hidden-xs-up"),$(i).removeClass("disabled")})}),$("body").on("click",".product #btn-addnewproduct",function(r){if($(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;var a=new FormData;a.append("addProduct",""),a.append("security",t);for(var s=$("#frm-info-product").serializeArray(),n=0;n<s.length;n++){if(""==s[n].value&&"material"!=s[n].name&&"origin"!=s[n].name&&s[n].name.indexOf("seo")<0)return void toast("Lỗi","Hãy nhập đầy đủ thông tin","error");if(("price"==s[n].name||"number"==s[n].name)&&isNaN(parseInt(s[n].value)))return void toast("Lỗi","price"==s[n].name?"Giá tiền không hợp lệ":"Số lượng không hợp lệ","error");a.append(s[n].name,s[n].value)}if(""!=listImage){for(n=0;n<listImage.length;n++)a.append("images[]",listImage[n]);var i=$(this).data("url");$(".progress").html("<span style='color:green'>Đang xử lý vui lòng chờ ...</span>"),$(this).addClass("disabled");var l=$(this);$.ajax({url:i,type:"POST",dataType:"JSON",data:a,cache:!1,contentType:!1,processData:!1}).done(function(e){if(e.error)for(var t=0;t<e.error.length;t++)toast("Lỗi",e.error[t],"error");e.success&&(toast("Thành công",e.success,"success"),$("#frm-info-product")[0].reset(),listImage=[],$("#my-awesome-dropzone").html('<div class="dz-default dz-message"><span>Chọn hoặc kéo thả hình ảnh vào đây!</span></div>'),$("#my-awesome-dropzone").removeClass("dz-started"))}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(".progress").html(""),$(l).removeClass("disabled")})}else toast("Lỗi","Hãy chọn ảnh hiển thị","error")}),$("body").on("click",".product .btn-delete",function(r){if($(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("admin"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;if(0==confirm("Xác nhận lại lệnh xóa.."))return!1;var a=$(this).data("url"),s=$(this);$(s).addClass("disabled"),$.ajax({url:a,type:"POST",dataType:"JSON",data:{security:t}}).done(function(e){e.success?(toast("Thành công",e.success,"success"),$(s).parent().parent().remove()):e.error?toast("Thất bại",e.error,"error"):toast("Thất bại","Lỗi server","error")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(s).removeClass("disabled")})}),$("body").on("submit",".product #frm-edit-product",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;if(0==confirm("Lưu thay đổi.."))return!1;for(var a=$("#frm-edit-product .changed"),s=[],n=0;n<a.length;n++)s[n]=$(a[n]).attr("name");var i=new FormData;i.append("security",t);var l=$("#frm-edit-product").serializeArray();for(n=0;n<l.length;n++)if(-1!=s.indexOf(l[n].name)){if(""==l[n].value)return void toast("Lỗi","Hãy nhập đầy đủ thông tin","error");if(("price"==l[n].name||"number"==l[n].name)&&isNaN(parseInt(l[n].value)))return void toast("Lỗi","price"==l[n].name?"Giá tiền không hợp lệ":"Số lượng không hợp lệ","error");i.append(l[n].name,l[n].value)}var o=$(".current-image"),d=[];for(n=0;n<o.length;n++)d[n]=$(o[n]).val();if(""!=d&&(d=JSON.stringify(d),i.append("currentimage",d)),""!=listImage)for(n=0;n<listImage.length;n++)i.append("images[]",listImage[n]);$(".progress").html("<span style='color:green'>Đang xử lý vui lòng chờ ...</span>");var c=$(this).data("url"),u=$(this);$(u).addClass("disabled"),$.ajax({url:c,type:"POST",dataType:"JSON",data:i,cache:!1,contentType:!1,processData:!1}).done(function(e){if(e.error)for(var t=0;t<e.error.length;t++)toast("Lỗi",e.error[t],"error");e.success&&toast("Thành công",e.success,"success")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(".progress").html(""),$(u).removeClass("disabled")})}),$("body").on("change","#frm-edit-product input,#frm-edit-product select",function(e){$(this).addClass("changed")}),$("body").on("click","#my-awesome-dropzone .btn-delete-image",function(e){e.preventDefault(),$(this).parent().remove()}),$("body").on("click",".product .btn-save-options",function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;for(var r=$(this),a=$("input.option-product-check"),s={checked:[],notcheck:[]},n={checked:[],notcheck:[]},i={checked:[],notcheck:[]},l=0;l<a.length;l++)"cbo-newproduct"==$(a[l]).attr("name")&&($(a[l]).is(":checked")?s.checked[s.checked.length]=parseInt($(a[l]).val()):s.notcheck[s.notcheck.length]=parseInt($(a[l]).val())),"cbo-sellerproduct"==$(a[l]).attr("name")&&($(a[l]).is(":checked")?n.checked[n.checked.length]=parseInt($(a[l]).val()):n.notcheck[n.notcheck.length]=parseInt($(a[l]).val())),"cbo-saleproduct"==$(a[l]).attr("name")&&($(a[l]).is(":checked")?i.checked[i.checked.length]=parseInt($(a[l]).val()):i.notcheck[i.notcheck.length]=parseInt($(a[l]).val()));var o=$(this).data("url");$(r).html("Đang xử lý ..."),$(r).addClass("disabled"),$.ajax({url:o,type:"POST",dataType:"JSON",data:{security:t,listnew:JSON.stringify(s),listseller:JSON.stringify(n),listsale:JSON.stringify(i)}}).done(function(e){e.error&&toast("Lỗi",e.error,"error"),e.success&&toast("Thành công",e.success,"success")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(r).removeClass("disabled"),$(r).html("Lưu lại")})}),$("body").on("change",".order-status",function(e){$(this).addClass("selectchanged")}),$("body").on("click",".update-status-order",function(r){if(r.preventDefault(),$(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;if("admin"!=e&&"mod"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;if($(this).parent().prev().children(".order-status").hasClass("selectchanged")){var a=$(this).prev('input[name="id-order"]').val(),s=$(this).parent().prev().children(".order-status").val(),n=$(this).data("url"),i=$(this);$(i).addClass("disabled"),$.ajax({url:n,type:"POST",dataType:"JSON",data:{id:a,status:s,security:t}}).done(function(e){e.error&&toast("Lỗi",e.error,"error"),e.success&&toast("Thành công",e.success,"success")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(i).removeClass("disabled")})}else toast("","Dữ liệu không thay đổi","error")}),$("body").on("click",".control-captcha .btn-edit",function(t){if(t.preventDefault(),"admin"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;$(this).addClass("hidden-xs-up"),$(this).next().removeClass("hidden-xs-up"),$(this).parent().prevAll("td").find("input").removeAttr("disabled")}),$("body").on("click",".control-captcha .btn-save",function(r){if(r.preventDefault(),"admin"!=e)return toast("Cảnh báo","Yêu cầu không được thực hiện. Vui lòng liên hệ ADMIN","error"),!1;if($(this).hasClass("disabled"))return toast("","Yêu cầu đang được xử lý. Vui lòng đợi","error"),!1;$(this).addClass("hidden-xs-up"),$(this).prev().removeClass("hidden-xs-up"),$(this).parent().prevAll("td").find("input").attr("disabled","disabled");var a=$(this).data("url"),s=$(this).nextAll("input[name='id']").val(),n=$(this).parent().prevAll("td").find('input[name="email"]').val(),i=$(this).parent().prevAll("td").find('input[name="publickey"]').val(),l=$(this).parent().prevAll("td").find('input[name="privatekey"]').val();if(""==s||""==n||""==i||""==l)return toast("","Dữ liệu không hợp lệ. Kiểm tra lại","error"),!1;var o=$(this);$(o).addClass("disabled"),$.ajax({url:a,type:"POST",dataType:"",data:{id:s,email:n,publickey:i,privatekey:l,security:t}}).done(function(e){e.error&&toast("Lỗi",e.error,"error"),e.success&&toast("Thành công",e.success,"success")}).fail(function(){toast("Thất bại","Lỗi server, kiểm tra lại đường truyền","error")}).always(function(){$(o).removeClass("disabled")})})});